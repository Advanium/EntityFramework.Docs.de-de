---
title: Arbeiten mit Verweis Typen, die NULL-Werte zulassen-EF Core
author: roji
ms.date: 09/09/2019
ms.assetid: bde4e0ee-fba3-4813-a849-27049323d301
uid: core/miscellaneous/nullable-reference-types
ms.openlocfilehash: 055f492214596506ce2c28485ade359d175c4ac2
ms.sourcegitcommit: 37d0e0fd1703467918665a64837dc54ad2ec7484
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 10/16/2019
ms.locfileid: "72445902"
---
# <a name="working-with-nullable-reference-types"></a><span data-ttu-id="a33af-102">Arbeiten mit Verweis Typen, die NULL-Werte zulassen</span><span class="sxs-lookup"><span data-stu-id="a33af-102">Working with Nullable Reference Types</span></span>

<span data-ttu-id="a33af-103">C#in 8 wurde ein neues Feature namens " [Werte zulässt Reference Types](/dotnet/csharp/tutorials/nullable-reference-types)" eingeführt, sodass Verweis Typen mit Anmerkungen versehen werden können. Dies deutet darauf hin, ob es zulässig ist, dass NULL-Werte enthalten sind.</span><span class="sxs-lookup"><span data-stu-id="a33af-103">C# 8 introduced a new feature called [nullable reference types](/dotnet/csharp/tutorials/nullable-reference-types), allowing reference types to be annotated, indicating whether it is valid for them to contain null or not.</span></span> <span data-ttu-id="a33af-104">Wenn Sie mit dieser Funktion noch nicht vertraut sind, wird empfohlen, dass Sie sich mit der Dokumentation vertraut C# machen, indem Sie die Dokumentation lesen.</span><span class="sxs-lookup"><span data-stu-id="a33af-104">If you are new to this feature, it is recommended that make yourself familiar with it by reading the C# docs.</span></span>

<span data-ttu-id="a33af-105">Auf dieser Seite wird EF Core Unterstützung für Verweis Typen eingeführt, die NULL-Werte zulassen, und es werden bewährte Methoden zum Arbeiten mit diesen beschrieben.</span><span class="sxs-lookup"><span data-stu-id="a33af-105">This page introduces EF Core's support for nullable reference types, and describes best practices for working with them.</span></span>

## <a name="required-and-optional-properties"></a><span data-ttu-id="a33af-106">Erforderliche und optionale Eigenschaften</span><span class="sxs-lookup"><span data-stu-id="a33af-106">Required and optional properties</span></span>

<span data-ttu-id="a33af-107">Die Haupt Dokumentation zu den erforderlichen und optionalen Eigenschaften sowie deren Interaktion mit Verweis Typen, die NULL-Werte zulassen, ist die [erforderliche und optionale Eigenschaften](xref:core/modeling/required-optional) Seite.</span><span class="sxs-lookup"><span data-stu-id="a33af-107">The main documentation on required and optional properties and their interaction with nullable reference types is the [Required and Optional Properties](xref:core/modeling/required-optional) page.</span></span> <span data-ttu-id="a33af-108">Es wird empfohlen, dass Sie zunächst die Seite lesen.</span><span class="sxs-lookup"><span data-stu-id="a33af-108">It is recommended you start out by reading that page first.</span></span>

> [!NOTE]
> <span data-ttu-id="a33af-109">Vorsicht beim Aktivieren von Verweis Typen, die NULL-Werte zulassen, für ein vorhandenes Projekt: Verweistyp Eigenschaften, die zuvor als optional konfiguriert wurden, werden nun als erforderlich konfiguriert, es sei denn, Sie sind explizit mit Anmerkungen versehen, die NULL-Werte zulassen.</span><span class="sxs-lookup"><span data-stu-id="a33af-109">Exercise caution when enabling nullable reference types on an existing project: reference type properties which were previously configured as optional will now be configured as required, unless they are explicitly annotated to be nullable.</span></span> <span data-ttu-id="a33af-110">Wenn Sie ein relationales Datenbankschema verwalten, kann dies dazu führen, dass Migrationen generiert werden, die die NULL-Zulässigkeit der Daten Bank Spalte ändern.</span><span class="sxs-lookup"><span data-stu-id="a33af-110">When managing a relational database schema, this may cause migrations to be generated which alter the database column's nullability.</span></span>

## <a name="dbcontext-and-dbset"></a><span data-ttu-id="a33af-111">Dbcontext und dbset</span><span class="sxs-lookup"><span data-stu-id="a33af-111">DbContext and DbSet</span></span>

<span data-ttu-id="a33af-112">Wenn Verweis Typen, die NULL-Werte zulassen C# , aktiviert sind, gibt der Compiler Warnungen für jede nicht initialisierte Eigenschaft aus, die keine NULL-Werte zulässt, da diese NULL-Werte enthalten.</span><span class="sxs-lookup"><span data-stu-id="a33af-112">When nullable reference types are enabled, the C# compiler emits warnings for any uninitialized non-nullable property, as these would contain null.</span></span> <span data-ttu-id="a33af-113">Folglich generiert die gängige Vorgehensweise, eine nicht auf NULL festleg Bare `DbSet` für einen Kontext zu definieren, jetzt eine Warnung.</span><span class="sxs-lookup"><span data-stu-id="a33af-113">As a result, the common practice of defining a non-nullable `DbSet` on a context will now generate a warning.</span></span> <span data-ttu-id="a33af-114">Allerdings initialisiert EF Core immer alle `DbSet`-Eigenschaften für von dbcontext abgeleitete Typen, sodass Sie sicher sind, dass Sie nie NULL sind, auch wenn der Compiler das nicht kennt.</span><span class="sxs-lookup"><span data-stu-id="a33af-114">However, EF Core always initializes all `DbSet` properties on DbContext-derived types, so they are guaranteed to never be null, even if the compiler is unaware of this.</span></span> <span data-ttu-id="a33af-115">Daher wird empfohlen, dass die `DbSet`-Eigenschaften nicht auf NULL festgelegt werden können, sodass Sie ohne Null-Überprüfungen darauf zugreifen können, und um die Compilerwarnungen zu stillen, indem Sie Sie mit der Hilfe des NULL-Operator Operators (!) explizit auf NULL festlegen:</span><span class="sxs-lookup"><span data-stu-id="a33af-115">Therefore, it is recommended to keep your `DbSet` properties non-nullable - allowing you to access them without null checks - and to silence the compiler warnings by explicitly setting them to null with the help of the null-forgiving operator (!):</span></span>

[!code-csharp[Main](../../../samples/core/Miscellaneous/NullableReferenceTypes/NullableReferenceTypesContext.cs?name=Context&highlight=3-4)]

## <a name="non-nullable-properties-and-initialization"></a><span data-ttu-id="a33af-116">Eigenschaften und Initialisierung, die keine NULL-Werte zulassen</span><span class="sxs-lookup"><span data-stu-id="a33af-116">Non-nullable properties and initialization</span></span>

<span data-ttu-id="a33af-117">Compilerwarnungen für nicht initialisierte Verweis Typen, die keine NULL-Werte zulassen, sind auch ein Problem für reguläre Eigenschaften ihrer Entitäts Typen.</span><span class="sxs-lookup"><span data-stu-id="a33af-117">Compiler warnings for uninitialized non-nullable reference types are also a problem for regular properties on your entity types.</span></span> <span data-ttu-id="a33af-118">Im obigen Beispiel haben wir diese Warnungen durch die Verwendung von [konstruktorbindung](xref:core/modeling/constructors)vermieden, eine Funktion, die perfekt mit nicht auf NULL festleg baren Eigenschaften funktioniert und sicherstellt, dass Sie immer initialisiert werden.</span><span class="sxs-lookup"><span data-stu-id="a33af-118">In our example above, we avoided these warnings by using [constructor binding](xref:core/modeling/constructors), a feature which works perfectly with non-nullable properties, ensuring they are always initialized.</span></span> <span data-ttu-id="a33af-119">In manchen Szenarios ist die konstruktorbindung jedoch keine Option: Navigations Eigenschaften können z. b. nicht auf diese Weise initialisiert werden.</span><span class="sxs-lookup"><span data-stu-id="a33af-119">However, in some scenarios constructor binding isn't an option: navigation properties, for example, cannot be initialized in this way.</span></span>

<span data-ttu-id="a33af-120">Erforderliche Navigations Eigenschaften stellen eine zusätzliche Schwierigkeit dar: Obwohl für einen bestimmten Prinzipal immer ein abhängiger vorhanden ist, kann er von einer bestimmten Abfrage geladen werden, je nach den Anforderungen an dieser Stelle im Programm ([Siehe die unterschiedlichen Muster für). Daten werden geladen](xref:core/querying/related-data)).</span><span class="sxs-lookup"><span data-stu-id="a33af-120">Required navigation properties present an additional difficulty: although a dependent will always exist for a given principal, it may or may not be loaded by a particular query, depending on the needs at that point in the program ([see the different patterns for loading data](xref:core/querying/related-data)).</span></span> <span data-ttu-id="a33af-121">Gleichzeitig ist es nicht wünschenswert, dass diese Eigenschaften auf NULL festgelegt werden, da dadurch der gesamte Zugriff auf NULL erzwungen werden würde, auch wenn Sie erforderlich sind.</span><span class="sxs-lookup"><span data-stu-id="a33af-121">At the same time, it is undesirable to make these properties nullable, since that would force all access to them to check for null, even if they are required.</span></span>

<span data-ttu-id="a33af-122">Eine Möglichkeit zum Umgang mit diesen Szenarien besteht darin, eine Eigenschaft, die keine NULL-Werte zulässt, mit einem dahinter liegenden [Feld](xref:core/modeling/backing-field)zu haben, das NULL-Werte zulässt</span><span class="sxs-lookup"><span data-stu-id="a33af-122">One way to deal with these scenarios, is to have a non-nullable property with a nullable [backing field](xref:core/modeling/backing-field):</span></span>

[!code-csharp[Main](../../../samples/core/Miscellaneous/NullableReferenceTypes/Order.cs?range=12-17)]

<span data-ttu-id="a33af-123">Da die Navigations Eigenschaft keine NULL-Werte zulässt, wird eine erforderliche Navigation konfiguriert. solange die Navigation ordnungsgemäß geladen ist, kann auf den abhängigen über die-Eigenschaft zugegriffen werden.</span><span class="sxs-lookup"><span data-stu-id="a33af-123">Since the navigation property is non-nullable, a required navigation is configured; and as long as the navigation is properly loaded, the dependent will be accessible via the property.</span></span> <span data-ttu-id="a33af-124">Wenn jedoch auf die Eigenschaft zugegriffen wird, ohne dass die zugehörige Entität zuvor ordnungsgemäß geladen wurde, wird eine InvalidOperationException ausgelöst, da der API-Vertrag falsch verwendet wurde.</span><span class="sxs-lookup"><span data-stu-id="a33af-124">If, however, the property is accessed without first properly loading the related entity, an InvalidOperationException is thrown, since the API contract has been used incorrectly.</span></span>

<span data-ttu-id="a33af-125">Als terser Alternative ist es möglich, die-Eigenschaft mit der Hilfe des NULL-Operator (!) einfach mit NULL zu initialisieren:</span><span class="sxs-lookup"><span data-stu-id="a33af-125">As a terser alternative, it is possible to simply initialize the property to null with the help of the null-forgiving operator (!):</span></span>

[!code-csharp[Main](../../../samples/core/Miscellaneous/NullableReferenceTypes/Order.cs?range=19)]

<span data-ttu-id="a33af-126">Ein tatsächlicher Null-Wert wird nie beobachtet, außer aufgrund eines Programmierfehlers, z. b. durch den Zugriff auf die Navigations Eigenschaft, ohne dass die zugehörige Entität vorab ordnungsgemäß geladen wird.</span><span class="sxs-lookup"><span data-stu-id="a33af-126">An actual null value will never be observed except as a result of a programming bug, e.g. accessing the navigation property without properly loading the related entity beforehand.</span></span>

> [!NOTE]
> <span data-ttu-id="a33af-127">Sammlungs Navigation, die Verweise auf mehrere verknüpfte Entitäten enthalten, sollte immer keine NULL-Werte zulassen.</span><span class="sxs-lookup"><span data-stu-id="a33af-127">Collection navigations, which contain references to multiple related entities, should always be non-nullable.</span></span> <span data-ttu-id="a33af-128">Eine leere Auflistung bedeutet, dass keine verknüpften Entitäten vorhanden sind, aber die Liste selbst darf nie NULL sein.</span><span class="sxs-lookup"><span data-stu-id="a33af-128">An empty collection means that no related entities exist, but the list itself should never be null.</span></span>

## <a name="navigating-and-including-nullable-relationships"></a><span data-ttu-id="a33af-129">Navigieren in und einschließen von null-fähigen Beziehungen</span><span class="sxs-lookup"><span data-stu-id="a33af-129">Navigating and including nullable relationships</span></span>

<span data-ttu-id="a33af-130">Beim Umgang mit optionalen Beziehungen können Compilerwarnungen auftreten, bei denen eine tatsächliche NULL-Verweis Ausnahme nicht möglich wäre.</span><span class="sxs-lookup"><span data-stu-id="a33af-130">When dealing with optional relationships, it's possible to encounter compiler warnings where an actual null reference exception would be impossible.</span></span> <span data-ttu-id="a33af-131">Wenn Sie Ihre LINQ-Abfragen übersetzen und ausführen, stellt EF Core sicher, dass die Navigation zu dieser nicht ausgelöst wird, wenn eine optionale verknüpfte Entität nicht vorhanden ist.</span><span class="sxs-lookup"><span data-stu-id="a33af-131">When translating and executing your LINQ queries, EF Core guarantees that if an optional related entity does not exist, any navigation to it will simply be ignored, rather than throwing.</span></span> <span data-ttu-id="a33af-132">Der Compiler kennt diese EF Core Garantie jedoch nicht und führt Warnungen aus, als ob die LINQ-Abfrage im Arbeitsspeicher ausgeführt wurde, mit LINQ to Objects.</span><span class="sxs-lookup"><span data-stu-id="a33af-132">However, the compiler is unaware of this EF Core guarantee, and produces warnings as if the LINQ query were executed in memory, with LINQ to Objects.</span></span> <span data-ttu-id="a33af-133">Daher ist es erforderlich, dass der Compiler den NULL-Operator (!) verwendet, um den Compiler darüber zu informieren, dass ein tatsächlicher Null-Wert nicht möglich ist:</span><span class="sxs-lookup"><span data-stu-id="a33af-133">As a result, it is necessary to use the null-forgiving operator (!) to inform the compiler that an actual null value isn't possible:</span></span>

[!code-csharp[Main](../../../samples/core/Miscellaneous/NullableReferenceTypes/Program.cs?range=46)]

<span data-ttu-id="a33af-134">Ein ähnliches Problem tritt auf, wenn mehrere Beziehungs Ebenen über optionale Navigationen eingeschlossen werden:</span><span class="sxs-lookup"><span data-stu-id="a33af-134">A similar issue occurs when including multiple levels of relationships across optional navigations:</span></span>

[!code-csharp[Main](../../../samples/core/Miscellaneous/NullableReferenceTypes/Program.cs?range=36-39&highlight=2)]

<span data-ttu-id="a33af-135">Wenn Sie dies sehr viel tun und die fraglichen Entitäts Typen vorwiegend (oder exklusiv) in EF Core Abfragen verwendet werden, sollten Sie die Navigations Eigenschaften in Erwägung ziehen, die nicht auf NULL festgelegt werden können, und Sie über die fließende API oder Daten Anmerkungen als optional konfigurieren.</span><span class="sxs-lookup"><span data-stu-id="a33af-135">If you find yourself doing this a lot, and the entity types in question are predominantly (or exclusively) used in EF Core queries, consider making the navigation properties non-nullable, and to configure them as optional via the Fluent API or Data Annotations.</span></span> <span data-ttu-id="a33af-136">Dadurch werden alle Compilerwarnungen entfernt, während die Beziehung optional bleibt. Wenn die Entitäten jedoch außerhalb EF Core durchlaufen werden, werden möglicherweise NULL-Werte beachtet, obwohl die Eigenschaften als nicht auf NULL festleg Bare Werte kommentiert werden.</span><span class="sxs-lookup"><span data-stu-id="a33af-136">This will remove all compiler warnings while keeping the relationship optional; however, if your entities are traversed outside of EF Core, you may observe null values although the properties are annotated as non-nullable.</span></span>

## <a name="scaffolding"></a><span data-ttu-id="a33af-137">Gerüstbau</span><span class="sxs-lookup"><span data-stu-id="a33af-137">Scaffolding</span></span>

<span data-ttu-id="a33af-138">[Das C# Feature 8, das NULL-Werte](/dotnet/csharp/tutorials/nullable-reference-types) zulässt, wird derzeit in Reverse Engineering nicht unterstützt C# : EF Core generiert immer Code, der davon ausgeht, dass das Feature deaktiviert ist.</span><span class="sxs-lookup"><span data-stu-id="a33af-138">[The C# 8 nullable reference type feature](/dotnet/csharp/tutorials/nullable-reference-types) is currently unsupported in reverse engineering: EF Core always generates C# code that assumes the feature is off.</span></span> <span data-ttu-id="a33af-139">Beispielsweise werden Textspalten, die NULL-Werte zulassen, als Eigenschaft mit dem Typ "`string`" und nicht "`string?`" erstellt, wobei entweder die fließende API oder die Daten Anmerkungen verwendet werden, um zu konfigurieren, ob eine Eigenschaft erforderlich ist.</span><span class="sxs-lookup"><span data-stu-id="a33af-139">For example, nullable text columns will be scaffolded as a property with type `string` , not `string?`, with either the Fluent API or Data Annotations used to configure whether a property is required or not.</span></span> <span data-ttu-id="a33af-140">Sie können den Gerüst Code bearbeiten und diese durch C# NULL-Zulässigkeit-Anmerkungen ersetzen.</span><span class="sxs-lookup"><span data-stu-id="a33af-140">You can edit the scaffolded code and replace these with C# nullability annotations.</span></span> <span data-ttu-id="a33af-141">Die Gerüstbau Unterstützung für Verweis Typen, die NULL-Werte zulassen, wird von Issue [#15520](https://github.com/aspnet/EntityFrameworkCore/issues/15520)</span><span class="sxs-lookup"><span data-stu-id="a33af-141">Scaffolding support for nullable reference types is tracked by issue [#15520](https://github.com/aspnet/EntityFrameworkCore/issues/15520).</span></span>
