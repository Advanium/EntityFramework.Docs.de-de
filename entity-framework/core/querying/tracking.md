---
title: 'Abfragen mit Nachverfolgung im Vergleich zu Abfragen ohne Nachverfolgung: EF Core'
author: smitpatel
ms.date: 10/10/2019
ms.assetid: e17e060c-929f-4180-8883-40c438fbcc01
uid: core/querying/tracking
ms.openlocfilehash: a6c71c12f429f1324abe91d1b2cef96312bec051
ms.sourcegitcommit: cc0ff36e46e9ed3527638f7208000e8521faef2e
ms.translationtype: HT
ms.contentlocale: de-DE
ms.lasthandoff: 03/06/2020
ms.locfileid: "78413696"
---
# <a name="tracking-vs-no-tracking-queries"></a><span data-ttu-id="3efa4-102">Abfragen mit Nachverfolgung im Vergleich zu Abfragen ohne Nachverfolgung</span><span class="sxs-lookup"><span data-stu-id="3efa4-102">Tracking vs. No-Tracking Queries</span></span>

<span data-ttu-id="3efa4-103">Das Nachverfolgungsverhalten steuert, ob Entity Framework Core Informationen über eine Entitätsinstanz in der Änderungsprotokollierung speichert.</span><span class="sxs-lookup"><span data-stu-id="3efa4-103">Tracking behavior controls if Entity Framework Core will keep information about an entity instance in its change tracker.</span></span> <span data-ttu-id="3efa4-104">Wenn eine Entität nachverfolgt wird, werden alle Änderungen, die in der Entität erkannt werden, während `SaveChanges()` in der Datenbank beibehalten.</span><span class="sxs-lookup"><span data-stu-id="3efa4-104">If an entity is tracked, any changes detected in the entity will be persisted to the database during `SaveChanges()`.</span></span> <span data-ttu-id="3efa4-105">EF Core korrigiert auch Unstimmigkeiten zwischen den Navigationseigenschaften von Entitäten in einem Nachverfolgungs-Abfrageergebnis und Entitäten, die sich in der Änderungsprotokollierung befinden.</span><span class="sxs-lookup"><span data-stu-id="3efa4-105">EF Core will also fix up navigation properties between the entities in a tracking query result and the entities that are in the change tracker.</span></span>

> [!NOTE]
> <span data-ttu-id="3efa4-106">[Schlüssellose Entitätstypen](xref:core/modeling/keyless-entity-types) werden nie nachverfolgt.</span><span class="sxs-lookup"><span data-stu-id="3efa4-106">[Keyless entity types](xref:core/modeling/keyless-entity-types) are never tracked.</span></span> <span data-ttu-id="3efa4-107">Wenn in diesem Artikel Entitätstypen erwähnt werden, sind Entitätstypen gemeint, für die ein Schlüssel definiert ist.</span><span class="sxs-lookup"><span data-stu-id="3efa4-107">Wherever this article mentions entity types, it refers to entity types which have a key defined.</span></span>

> [!TIP]  
> <span data-ttu-id="3efa4-108">Das in diesem Artikel verwendete [Beispiel](https://github.com/dotnet/EntityFramework.Docs/tree/master/samples/core/Querying) finden Sie auf GitHub.</span><span class="sxs-lookup"><span data-stu-id="3efa4-108">You can view this article's [sample](https://github.com/dotnet/EntityFramework.Docs/tree/master/samples/core/Querying) on GitHub.</span></span>

## <a name="tracking-queries"></a><span data-ttu-id="3efa4-109">Abfragen mit Nachverfolgung</span><span class="sxs-lookup"><span data-stu-id="3efa4-109">Tracking queries</span></span>

<span data-ttu-id="3efa4-110">Abfragen, die Entitätstypen zurückgeben, verfügen standardmäßig über Nachverfolgung.</span><span class="sxs-lookup"><span data-stu-id="3efa4-110">By default, queries that return entity types are tracking.</span></span> <span data-ttu-id="3efa4-111">Das bedeutet, Sie können Änderungen an diesen Entitätsinstanzen vornehmen, und diese Änderungen werden von `SaveChanges()` beibehalten.</span><span class="sxs-lookup"><span data-stu-id="3efa4-111">Which means you can make changes to those entity instances and have those changes persisted by `SaveChanges()`.</span></span> <span data-ttu-id="3efa4-112">Im folgenden Beispiel wird die Änderung an der Bewertung des Blogs erkannt und während `SaveChanges()` in der Datenbank beibehalten.</span><span class="sxs-lookup"><span data-stu-id="3efa4-112">In the following example, the change to the blogs rating will be detected and persisted to the database during `SaveChanges()`.</span></span>

[!code-csharp[Main](../../../samples/core/Querying/Tracking/Sample.cs#Tracking)]

## <a name="no-tracking-queries"></a><span data-ttu-id="3efa4-113">Abfragen ohne Nachverfolgung</span><span class="sxs-lookup"><span data-stu-id="3efa4-113">No-tracking queries</span></span>

<span data-ttu-id="3efa4-114">Abfragen ohne Nachverfolgung sind nützlich, wenn die Ergebnisse in einem schreibgeschützten Szenario verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="3efa4-114">No tracking queries are useful when the results are used in a read-only scenario.</span></span> <span data-ttu-id="3efa4-115">Sie werden schneller ausgeführt, da keine Informationen für die Änderungsnachverfolgung eingerichtet werden müssen.</span><span class="sxs-lookup"><span data-stu-id="3efa4-115">They're quicker to execute because there's no need to set up the change tracking information.</span></span> <span data-ttu-id="3efa4-116">Wenn Sie die aus der Datenbank abgerufenen Entitäten nicht aktualisieren müssen, sollte eine Abfrage ohne Nachverfolgung verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="3efa4-116">If you don't need to update the entities retrieved from the database, then a no-tracking query should be used.</span></span> <span data-ttu-id="3efa4-117">Sie können eine einzelne Abfrage ändern, sodass sie keine Nachverfolgung ausführt.</span><span class="sxs-lookup"><span data-stu-id="3efa4-117">You can swap an individual query to be no-tracking.</span></span>

[!code-csharp[Main](../../../samples/core/Querying/Tracking/Sample.cs#NoTracking)]

<span data-ttu-id="3efa4-118">Sie können das Standardnachverfolgungsverhalten auch auf der Ebene der Kontextinstanz ändern:</span><span class="sxs-lookup"><span data-stu-id="3efa4-118">You can also change the default tracking behavior at the context instance level:</span></span>

[!code-csharp[Main](../../../samples/core/Querying/Tracking/Sample.cs#ContextDefaultTrackingBehavior)]

## <a name="identity-resolution"></a><span data-ttu-id="3efa4-119">Identitätsauflösung</span><span class="sxs-lookup"><span data-stu-id="3efa4-119">Identity resolution</span></span>

<span data-ttu-id="3efa4-120">Da eine Nachverfolgungsabfrage die Änderungsprotokollierung verwendet, führt EF Core in einer Nachverfolgungsabfrage eine Identitätsauflösung durch.</span><span class="sxs-lookup"><span data-stu-id="3efa4-120">Since a tracking query uses the change tracker, EF Core will do identity resolution in a tracking query.</span></span> <span data-ttu-id="3efa4-121">Beim Materialisieren einer Entität gibt EF Core dieselbe Entitätsinstanz aus der Änderungsprotokollierung zurück, wenn sie bereits nachverfolgt wird.</span><span class="sxs-lookup"><span data-stu-id="3efa4-121">When materializing an entity, EF Core will return the same entity instance from the change tracker if it's already being tracked.</span></span> <span data-ttu-id="3efa4-122">Wenn das Ergebnis mehrmals dieselbe Entität enthält, erhalten Sie für jedes Vorkommen dieselbe Instanz.</span><span class="sxs-lookup"><span data-stu-id="3efa4-122">If the result contains same entity multiple times, you get back same instance for each occurrence.</span></span> <span data-ttu-id="3efa4-123">Abfragen ohne Nachverfolgung verwenden weder die Änderungsprotokollierung, noch führen sie eine Identitätsauflösung durch.</span><span class="sxs-lookup"><span data-stu-id="3efa4-123">No-tracking queries don't use the change tracker and don't do identity resolution.</span></span> <span data-ttu-id="3efa4-124">Sie erhalten also auch dann eine neue Instanz der Entität, wenn dieselbe Entität mehrmals im Ergebnis enthalten ist.</span><span class="sxs-lookup"><span data-stu-id="3efa4-124">So you get back new instance of entity even when the same entity is contained in the result multiple times.</span></span> <span data-ttu-id="3efa4-125">Dieses Verhalten war in Versionen vor EF Core 3.0 anders, siehe [frühere Versionen](#previous-versions).</span><span class="sxs-lookup"><span data-stu-id="3efa4-125">This behavior was different in versions before EF Core 3.0, see [previous versions](#previous-versions).</span></span>

## <a name="tracking-and-custom-projections"></a><span data-ttu-id="3efa4-126">Nachverfolgung und benutzerdefinierte Projektionen</span><span class="sxs-lookup"><span data-stu-id="3efa4-126">Tracking and custom projections</span></span>

<span data-ttu-id="3efa4-127">Selbst wenn der Ergebnistyp der Abfrage kein Entitätstyp ist, verfolgt EF Core im Ergebnis enthaltene Entitätstypen standardmäßig nach.</span><span class="sxs-lookup"><span data-stu-id="3efa4-127">Even if the result type of the query isn't an entity type, EF Core will still track entity types contained in the result by default.</span></span> <span data-ttu-id="3efa4-128">In der folgenden Abfrage, die einen anonymen Typ zurückgibt, werden die Instanzen von `Blog` im Ergebnis nachverfolgt.</span><span class="sxs-lookup"><span data-stu-id="3efa4-128">In the following query, which returns an anonymous type, the instances of `Blog` in the result set will be tracked.</span></span>

[!code-csharp[Main](../../../samples/core/Querying/Tracking/Sample.cs#CustomProjection1)]

<span data-ttu-id="3efa4-129">Wenn das Resultset Entitätstypen enthält, die aus der LINQ-Komposition stammen, werden sie von EF Core nachverfolgt.</span><span class="sxs-lookup"><span data-stu-id="3efa4-129">If the result set contains entity types coming out from LINQ composition, EF Core will track them.</span></span>

[!code-csharp[Main](../../../samples/core/Querying/Tracking/Sample.cs#CustomProjection2)]

<span data-ttu-id="3efa4-130">Wenn das Resultset keine Entitätstypen enthält, wird keine Nachverfolgung ausgeführt.</span><span class="sxs-lookup"><span data-stu-id="3efa4-130">If the result set doesn't contain any entity types, then no tracking is done.</span></span> <span data-ttu-id="3efa4-131">In der folgenden Abfrage geben wir einen anonymen Typ mit einigen Werten der Entität zurück (aber keine Instanzen des aktuellen Entitätstyps).</span><span class="sxs-lookup"><span data-stu-id="3efa4-131">In the following query, we return an anonymous type with some of the values from the entity (but no instances of the actual entity type).</span></span> <span data-ttu-id="3efa4-132">Es sind keine aus der Abfrage stammenden nachverfolgten Entitäten vorhanden.</span><span class="sxs-lookup"><span data-stu-id="3efa4-132">There are no tracked entities coming out of the query.</span></span>

[!code-csharp[Main](../../../samples/core/Querying/Tracking/Sample.cs#CustomProjection3)]

 <span data-ttu-id="3efa4-133">EF Core unterstützt die Clientauswertung in der Projektion auf oberster Ebene.</span><span class="sxs-lookup"><span data-stu-id="3efa4-133">EF Core supports doing client evaluation in the top-level projection.</span></span> <span data-ttu-id="3efa4-134">Wenn EF Core eine Entitätsinstanz für die Clientauswertung materialisiert, wird sie nachverfolgt.</span><span class="sxs-lookup"><span data-stu-id="3efa4-134">If EF Core materializes an entity instance for client evaluation, it will be tracked.</span></span> <span data-ttu-id="3efa4-135">Da wir hier `blog`-Entitäten an die Clientmethode `StandardizeURL` übergeben, verfolgt EF Core auch die Bloginstanzen nach.</span><span class="sxs-lookup"><span data-stu-id="3efa4-135">Here, since we're passing `blog` entities to the client method `StandardizeURL`, EF Core will track the blog instances too.</span></span>

[!code-csharp[Main](../../../samples/core/Querying/Tracking/Sample.cs#ClientProjection)]

[!code-csharp[Main](../../../samples/core/Querying/Tracking/Sample.cs#ClientMethod)]

<span data-ttu-id="3efa4-136">EF Core verfolgt nicht die schlüssellosen Entitätsinstanzen nach, die im Ergebnis enthalten sind.</span><span class="sxs-lookup"><span data-stu-id="3efa4-136">EF Core doesn't track the keyless entity instances contained in the result.</span></span> <span data-ttu-id="3efa4-137">EF Core verfolgt jedoch alle anderen Instanzen von Entitätstypen mit Schlüssel gemäß den oben aufgeführten Regeln nach.</span><span class="sxs-lookup"><span data-stu-id="3efa4-137">But EF Core tracks all the other instances of entity types with key according to rules above.</span></span>

<span data-ttu-id="3efa4-138">Einige der oben genannten Regeln funktionierten vor EF Core 3.0 anders.</span><span class="sxs-lookup"><span data-stu-id="3efa4-138">Some of the above rules worked differently before EF Core 3.0.</span></span> <span data-ttu-id="3efa4-139">Weitere Informationen siehe [frühere Versionen](#previous-versions).</span><span class="sxs-lookup"><span data-stu-id="3efa4-139">For more information, see [previous versions](#previous-versions).</span></span>

## <a name="previous-versions"></a><span data-ttu-id="3efa4-140">Frühere Versionen</span><span class="sxs-lookup"><span data-stu-id="3efa4-140">Previous versions</span></span>

<span data-ttu-id="3efa4-141">Vor Version 3.0 wies EF Core bei der Nachverfolgung einige Unterschiede auf.</span><span class="sxs-lookup"><span data-stu-id="3efa4-141">Before version 3.0, EF Core had some differences in how tracking was done.</span></span> <span data-ttu-id="3efa4-142">Wesentliche Unterschiede sind:</span><span class="sxs-lookup"><span data-stu-id="3efa4-142">Notable differences are as follows:</span></span>

- <span data-ttu-id="3efa4-143">Wie auf der Seite [Clientauswertung im Vergleich zur Serverauswertung](xref:core/querying/client-eval) erläutert, unterstützte EF Core vor Version 3.0 die Clientauswertung in einem beliebigen Teil der Abfrage.</span><span class="sxs-lookup"><span data-stu-id="3efa4-143">As explained in [Client vs Server Evaluation](xref:core/querying/client-eval) page, EF Core supported client evaluation in any part of the query before version 3.0.</span></span> <span data-ttu-id="3efa4-144">Die Clientauswertung verursachte Materialisierungen von Entitäten, die nicht Teil des Ergebnisses waren.</span><span class="sxs-lookup"><span data-stu-id="3efa4-144">Client evaluation caused materialization of entities, which weren't part of the result.</span></span> <span data-ttu-id="3efa4-145">Daher analysierte EF Core das Ergebnis, um zu ermitteln, was nachverfolgt werden soll. Dieser Entwurf wies wie folgt bestimmte Unterschiede auf:</span><span class="sxs-lookup"><span data-stu-id="3efa4-145">So EF Core analyzed the result to detect what to track. This design had certain differences as follows:</span></span>
  - <span data-ttu-id="3efa4-146">Clientauswertung in der Projektion, die die Materialisierung verursachte, aber die materialisierte Entitätsinstanz nicht zurückgab, wurde nicht nachverfolgt.</span><span class="sxs-lookup"><span data-stu-id="3efa4-146">Client evaluation in the projection, which caused materialization but didn't return the materialized entity instance wasn't tracked.</span></span> <span data-ttu-id="3efa4-147">Im folgenden Beispiel wurden `blog`-Entitäten nicht nachverfolgt.</span><span class="sxs-lookup"><span data-stu-id="3efa4-147">The following example didn't track `blog` entities.</span></span>
    [!code-csharp[Main](../../../samples/core/Querying/Tracking/Sample.cs#ClientProjection)]

  - <span data-ttu-id="3efa4-148">In bestimmten Fällen wurden aus der LINQ-Komposition stammende Objekte von EF Core nicht nachverfolgt.</span><span class="sxs-lookup"><span data-stu-id="3efa4-148">EF Core didn't track the objects coming out of LINQ composition in certain cases.</span></span> <span data-ttu-id="3efa4-149">Im folgenden Beispiel wurde `Post` nicht nachverfolgt.</span><span class="sxs-lookup"><span data-stu-id="3efa4-149">The following example didn't track `Post`.</span></span>
    [!code-csharp[Main](../../../samples/core/Querying/Tracking/Sample.cs#CustomProjection2)]

- <span data-ttu-id="3efa4-150">Wenn Abfrageergebnisse schlüssellose Entitätstypen enthielten, wurde die gesamte Abfrage nicht nachverfolgt.</span><span class="sxs-lookup"><span data-stu-id="3efa4-150">Whenever query results contained keyless entity types, the whole query was made non-tracking.</span></span> <span data-ttu-id="3efa4-151">Dies bedeutet, dass Entitätstypen mit Schlüsseln, die sich in einem Ergebnis befanden, auch nicht nachverfolgt wurden.</span><span class="sxs-lookup"><span data-stu-id="3efa4-151">That means that entity types with keys, which are in result weren't being tracked either.</span></span>
- <span data-ttu-id="3efa4-152">EF Core führte in Abfragen ohne Nachverfolgung keine Identitätsauflösung durch.</span><span class="sxs-lookup"><span data-stu-id="3efa4-152">EF Core did identity resolution in no-tracking query.</span></span> <span data-ttu-id="3efa4-153">Schwache Verweise wurden verwendet, um bereits zurückgegebene Entitäten nachzuverfolgen.</span><span class="sxs-lookup"><span data-stu-id="3efa4-153">It used weak references to keep track of entities that had already been returned.</span></span> <span data-ttu-id="3efa4-154">Wenn also ein Resultset dieselbe Entität mehrfach enthielt, erhielten Sie für jedes Vorkommen dieselbe Instanz.</span><span class="sxs-lookup"><span data-stu-id="3efa4-154">So if a result set contained the same entity multiples times, you would get the same instance for each occurrence.</span></span> <span data-ttu-id="3efa4-155">Auch wenn ein vorheriges Ergebnis mit derselben Identität den Gültigkeitsbereich verließ und eine Garbage Collection durchgeführt wurde, gab EF Core eine neue Instanz zurück.</span><span class="sxs-lookup"><span data-stu-id="3efa4-155">Though if a previous result with the same identity went out of scope and got garbage collected, EF Core returned a new instance.</span></span>
