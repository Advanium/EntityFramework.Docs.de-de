---
title: Funktionsweise von Abfragen – EF Core
author: rowanmiller
ms.date: 10/27/2016
ms.assetid: de2e34cd-659b-4cab-b5ed-7a979c6bf120
uid: core/querying/overview
ms.openlocfilehash: f1c23471bfbc998b2d4f9dc579d1404d6202e109
ms.sourcegitcommit: dadee5905ada9ecdbae28363a682950383ce3e10
ms.translationtype: HT
ms.contentlocale: de-DE
ms.lasthandoff: 08/27/2018
ms.locfileid: "42993202"
---
# <a name="how-queries-work"></a><span data-ttu-id="9f641-102">Funktionsweise von Abfragen</span><span class="sxs-lookup"><span data-stu-id="9f641-102">How Queries Work</span></span>

<span data-ttu-id="9f641-103">Entity Framework Core verwendet Language Integrated Query (LINQ), um Daten von der Datenbank abzufragen.</span><span class="sxs-lookup"><span data-stu-id="9f641-103">Entity Framework Core uses Language Integrated Query (LINQ) to query data from the database.</span></span> <span data-ttu-id="9f641-104">LINQ ermöglicht Ihnen, mit C# (oder Ihrer bevorzugten .NET-Sprache) stark typisierte Abfragen basierend auf Ihrem abgeleiteten Kontext und Entitätsklassen zu schreiben.</span><span class="sxs-lookup"><span data-stu-id="9f641-104">LINQ allows you to use C# (or your .NET language of choice) to write strongly typed queries based on your derived context and entity classes.</span></span>

## <a name="the-life-of-a-query"></a><span data-ttu-id="9f641-105">Der Abfragezyklus</span><span class="sxs-lookup"><span data-stu-id="9f641-105">The life of a query</span></span>

<span data-ttu-id="9f641-106">Nachstehend finden Sie eine grobe Übersicht über die verschiedenen Phasen des Abfragevorgangs.</span><span class="sxs-lookup"><span data-stu-id="9f641-106">The following is a high level overview of the process each query goes through.</span></span>

1. <span data-ttu-id="9f641-107">Die LINQ-Abfrage wird von Entity Framework Core verarbeitet. Dabei wird eine Darstellung erstellt, die wiederum vom Datenbankanbieter verarbeitet wird.</span><span class="sxs-lookup"><span data-stu-id="9f641-107">The LINQ query is processed by Entity Framework Core to build a representation that is ready to be processed by the database provider</span></span>
   1. <span data-ttu-id="9f641-108">Das Ergebnis wird zwischengespeichert, damit dieser Vorgang nicht jedes Mal ausgeführt werden muss, wenn die Abfrage ausgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="9f641-108">The result is cached so that this processing does not need to be done every time the query is executed</span></span>
2. <span data-ttu-id="9f641-109">Das Ergebnis wird an den Datenbankanbieter übergeben.</span><span class="sxs-lookup"><span data-stu-id="9f641-109">The result is passed to the database provider</span></span>
   1. <span data-ttu-id="9f641-110">Der Datenbankanbieter ermittelt, welche Teile der Abfrage in der Datenbank ausgewertet werden können.</span><span class="sxs-lookup"><span data-stu-id="9f641-110">The database provider identifies which parts of the query can be evaluated in the database</span></span>
   2. <span data-ttu-id="9f641-111">Diese Teile der Abfrage werden in die datenbankspezifische Abfragesprache übersetzt, z.B. SQL für relationale Datenbanken.</span><span class="sxs-lookup"><span data-stu-id="9f641-111">These parts of the query are translated to database specific query language (for example, SQL for a relational database)</span></span>
   3. <span data-ttu-id="9f641-112">Mindestens eine Abfrage wird an die Datenbank gesendet, und das Resultset wird zurückgegeben (Ergebnisse sind Datenbankwerte, keine Entitätsinstanzen).</span><span class="sxs-lookup"><span data-stu-id="9f641-112">One or more queries are sent to the database and the result set returned (results are values from the database, not entity instances)</span></span>
3. <span data-ttu-id="9f641-113">Für jedes Element im Resultset wird Folgendes ausgeführt:</span><span class="sxs-lookup"><span data-stu-id="9f641-113">For each item in the result set</span></span>
   1. <span data-ttu-id="9f641-114">Wenn es sich um eine Überwachungsabfrage handelt, überprüft EF, ob die Daten eine Entität darstellen, die bereits in der Änderungsnachverfolgung für die Kontextinstanz vorhanden ist.</span><span class="sxs-lookup"><span data-stu-id="9f641-114">If this is a tracking query, EF checks if the data represents an entity already in the change tracker for the context instance</span></span>
      * <span data-ttu-id="9f641-115">Wenn dies der Fall ist, wird die vorhandene Entität zurückgegeben.</span><span class="sxs-lookup"><span data-stu-id="9f641-115">If so, the existing entity is returned</span></span>
      * <span data-ttu-id="9f641-116">Wenn dies nicht der Fall ist, wird eine neue Entität erstellt, die Änderungsnachverfolgung wird eingerichtet, und die neue Entität wird zurückgegeben.</span><span class="sxs-lookup"><span data-stu-id="9f641-116">If not, a new entity is created, change tracking is setup, and the new entity is returned</span></span>
   2. <span data-ttu-id="9f641-117">Wenn dies keine Überwachungsabfrage ist, überprüft EF, ob die Daten eine Entität darstellen, die bereits im Resultset der Abfrage vorhanden ist.</span><span class="sxs-lookup"><span data-stu-id="9f641-117">If this is a no-tracking query, EF checks if the data represents an entity already in the result set for this query</span></span>
      * <span data-ttu-id="9f641-118">Wenn dies der Fall ist, wird die vorhandene Entität zurückgegeben.<sup>(1)</sup></span><span class="sxs-lookup"><span data-stu-id="9f641-118">If so, the existing entity is returned <sup>(1)</sup></span></span>
      * <span data-ttu-id="9f641-119">Wenn dies nicht der Fall ist, wird eine neue Entität erstellt und zurückgegeben.</span><span class="sxs-lookup"><span data-stu-id="9f641-119">If not, a new entity is created and returned</span></span>

<span data-ttu-id="9f641-120"><sup>(1)</sup> Abfragen, die keine Überwachungsabfragen sind, verwenden schwache Verweise, um Entitäten nachzuverfolgen, die bereits zurückgegeben wurden.</span><span class="sxs-lookup"><span data-stu-id="9f641-120"><sup>(1)</sup> No tracking queries use weak references to keep track of entities that have already been returned.</span></span> <span data-ttu-id="9f641-121">Wenn ein vorheriges Ergebnis mit derselben Identität den gültigen Bereich verlässt und die Garbage Collection ausgeführt wird, können Sie eine neue Entitätsinstanz abrufen.</span><span class="sxs-lookup"><span data-stu-id="9f641-121">If a previous result with the same identity goes out of scope, and garbage collection runs, you may get a new entity instance.</span></span>

## <a name="when-queries-are-executed"></a><span data-ttu-id="9f641-122">Ausführen von Abfragen</span><span class="sxs-lookup"><span data-stu-id="9f641-122">When queries are executed</span></span>

<span data-ttu-id="9f641-123">Wenn Sie LINQ-Operatoren aufrufen, erstellen Sie einfach eine speicherinterne Darstellung der Abfrage.</span><span class="sxs-lookup"><span data-stu-id="9f641-123">When you call LINQ operators, you are simply building up an in-memory representation of the query.</span></span> <span data-ttu-id="9f641-124">Die Abfrage wird nur an die Datenbank gesendet, wenn die Ergebnisse verarbeitet werden.</span><span class="sxs-lookup"><span data-stu-id="9f641-124">The query is only sent to the database when the results are consumed.</span></span>

<span data-ttu-id="9f641-125">Dies sind die üblichsten Vorgänge, aufgrund derer die Abfrage wird an die Datenbank gesendet wird:</span><span class="sxs-lookup"><span data-stu-id="9f641-125">The most common operations that result in the query being sent to the database are:</span></span>
* <span data-ttu-id="9f641-126">Durchlaufen die Ergebnisse in einer `for`-Schleife</span><span class="sxs-lookup"><span data-stu-id="9f641-126">Iterating the results in a `for` loop</span></span>
* <span data-ttu-id="9f641-127">Verwenden eines Operators wie `ToList`, `ToArray`, `Single` oder `Count`</span><span class="sxs-lookup"><span data-stu-id="9f641-127">Using an operator such as `ToList`, `ToArray`, `Single`, `Count`</span></span>
* <span data-ttu-id="9f641-128">Datenbindung der Ergebnisse einer Abfrage an eine Benutzeroberfläche</span><span class="sxs-lookup"><span data-stu-id="9f641-128">Databinding the results of a query to a UI</span></span>

> [!WARNING]  
> <span data-ttu-id="9f641-129">**Benutzereingaben immer überprüfen:** EF bietet zwar Schutz vor Angriffen durch Einschleusung von SQL-Befehlen, jedoch keine allgemeine Überprüfung der Eingabe.</span><span class="sxs-lookup"><span data-stu-id="9f641-129">**Always validate user input:** While EF does provide protection from SQL injection attacks, it does not do any general validation of input.</span></span> <span data-ttu-id="9f641-130">Stammen Werte, die z.B. an APIs übergeben, in LINQ-Abfragen verwendet oder Entitätseigenschaften zugewiesen werden, aus einer nicht vertrauenswürdigen Quelle, sollte gemäß den Anwendungsanforderungen eine angemessene Prüfung vorgenommen werden.</span><span class="sxs-lookup"><span data-stu-id="9f641-130">Therefore if values being passed to APIs, used in LINQ queries, assigned to entity properties, etc., come from an untrusted source then appropriate validation, per your application requirements, should be performed.</span></span> <span data-ttu-id="9f641-131">Dies schließt alle Benutzereingaben ein, mit denen Abfragen dynamisch erstellt werden.</span><span class="sxs-lookup"><span data-stu-id="9f641-131">This includes any user input used to dynamically construct queries.</span></span> <span data-ttu-id="9f641-132">Wenn Sie Benutzereingaben zum Erstellen von Ausdrücken zulassen, müssen Sie selbst bei LINQ sicherstellen, dass nur beabsichtigte Ausdrücke erstellt werden können.</span><span class="sxs-lookup"><span data-stu-id="9f641-132">Even when using LINQ, if you are accepting user input to build expressions you need to make sure than only intended expressions can be constructed.</span></span>
