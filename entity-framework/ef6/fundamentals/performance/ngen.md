---
title: Verbessern der Leistung mit NGen - EF6 beim Start
author: divega
ms.date: 10/23/2016
ms.assetid: dc6110a0-80a0-4370-8190-cea942841cee
ms.openlocfilehash: 2e9a93c7741046da25b890fed084a6b280bf5643
ms.sourcegitcommit: 2b787009fd5be5627f1189ee396e708cd130e07b
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 09/13/2018
ms.locfileid: "45489959"
---
# <a name="improving-startup-performance-with-ngen"></a><span data-ttu-id="e7c67-102">Verbessern der Leistung mit NGen beim Start</span><span class="sxs-lookup"><span data-stu-id="e7c67-102">Improving startup performance with NGen</span></span>
> [!NOTE]
> <span data-ttu-id="e7c67-103">**Nur EF6 und höher:** Die Features, APIs usw., die auf dieser Seite erläutert werden, wurden in Entity Framework 6 eingeführt.</span><span class="sxs-lookup"><span data-stu-id="e7c67-103">**EF6 Onwards Only** - The features, APIs, etc. discussed in this page were introduced in Entity Framework 6.</span></span> <span data-ttu-id="e7c67-104">Wenn Sie eine frühere Version verwenden, gelten manche Informationen nicht.</span><span class="sxs-lookup"><span data-stu-id="e7c67-104">If you are using an earlier version, some or all of the information does not apply.</span></span>  

<span data-ttu-id="e7c67-105">.NET Framework unterstützt die Generierung von systemeigenen Images für verwaltete Anwendungen und Bibliotheken, die als eine Methode, um Anwendungen schneller gestartet werden und auch in einigen Fällen verwenden Sie weniger Arbeitsspeicher.</span><span class="sxs-lookup"><span data-stu-id="e7c67-105">The .NET Framework supports the generation of native images for managed applications and libraries as a way to help applications start faster and also in some cases use less memory.</span></span> <span data-ttu-id="e7c67-106">Systemeigene Images werden durch die Übersetzung von Assemblys mit verwaltetem Code in Dateien, die systemeigene maschinenanweisungen enthält, bevor die Anwendung ausgeführt wird, sind daher weniger erspart, generieren die systemeigenen Anweisungen unter den .NET JIT (Just-In-Time)-Compiler erstellt Laufzeit der Anwendung.</span><span class="sxs-lookup"><span data-stu-id="e7c67-106">Native images are created by translating managed code assemblies into files containing native machine instructions before the application is executed, relieving the .NET JIT (Just-In-Time) compiler from having to generate the native instructions at application runtime.</span></span>  

<span data-ttu-id="e7c67-107">Vor Version 6 die EF-Runtime-Core-Bibliotheken wurden Teil von .NET Framework, und systemeigene Images automatisch für sie generiert wurden.</span><span class="sxs-lookup"><span data-stu-id="e7c67-107">Prior to version 6, the EF runtime’s core libraries were part of the .NET Framework and native images were generated automatically for them.</span></span> <span data-ttu-id="e7c67-108">Ab Version 6 wurde die gesamte EF-Runtime in EntityFramework NuGet-Paket kombiniert.</span><span class="sxs-lookup"><span data-stu-id="e7c67-108">Starting with version 6 the whole EF runtime has been combined into the EntityFramework NuGet package.</span></span> <span data-ttu-id="e7c67-109">Systemeigene Images haben, jetzt generiert mit dem NGen.exe-Befehlszeilentool, um ähnliche Ergebnisse zu erhalten.</span><span class="sxs-lookup"><span data-stu-id="e7c67-109">Native images have to now be generated using the NGen.exe command line tool to obtain similar results.</span></span>  

<span data-ttu-id="e7c67-110">Empirische Beobachtungen zeigen, dass systemeigene Images die EF Runtime nach Assemblys zwischen 1 und 3 Sekunden der Startzeit der Anwendung verringert werden können.</span><span class="sxs-lookup"><span data-stu-id="e7c67-110">Empirical observations show that native images of the EF runtime assemblies can cut between 1 and 3 seconds of application startup time.</span></span>  

## <a name="how-to-use-ngenexe"></a><span data-ttu-id="e7c67-111">Gewusst wie: Verwenden von NGen.exe</span><span class="sxs-lookup"><span data-stu-id="e7c67-111">How to use NGen.exe</span></span>  

<span data-ttu-id="e7c67-112">Ist die grundlegendste Funktion dem NGen.exe-Tool "installieren" (d. h. erstellen und auf dem Datenträger beibehalten) systemeigene Images für eine Assembly und alle direkten Abhängigkeiten.</span><span class="sxs-lookup"><span data-stu-id="e7c67-112">The most basic function of the NGen.exe tool is to “install” (that is, to create and persist to disk) native images for an assembly and all its direct dependencies.</span></span> <span data-ttu-id="e7c67-113">Hier ist, wie Sie die, die erreichen können:</span><span class="sxs-lookup"><span data-stu-id="e7c67-113">Here is how you can achieve that:</span></span>  

1. <span data-ttu-id="e7c67-114">Öffnen Sie ein Eingabeaufforderungsfenster als administrator</span><span class="sxs-lookup"><span data-stu-id="e7c67-114">Open a Command Prompt window as an administrator</span></span>  
2. <span data-ttu-id="e7c67-115">Ändern Sie das aktuelle Arbeitsverzeichnis auf den Speicherort der Assemblys, denen Sie für die systemeigene Abbilder generieren möchten:</span><span class="sxs-lookup"><span data-stu-id="e7c67-115">Change the current working directory to the location of the assemblies you want to generate native images for:</span></span>  

  ``` console
    cd <*Assemblies location*>  
  ```
3. <span data-ttu-id="e7c67-116">Je nach Betriebssystem und die Konfiguration der Anwendung müssen Sie zum Generieren von systemeigenen Images für 32-Bit-Architektur, 64-Bit-Architektur oder für beides.</span><span class="sxs-lookup"><span data-stu-id="e7c67-116">Depending on your operating system and the application’s configuration you might need to generate native images for 32 bit architecture, 64 bit architecture or for both.</span></span>  

    <span data-ttu-id="e7c67-117">Für 32-Bit ausführen:</span><span class="sxs-lookup"><span data-stu-id="e7c67-117">For 32 bit run:</span></span>  
  ``` console
    %WINDIR%\Microsoft.NET\Framework\v4.0.30319\ngen install <Assembly name>  
  ```
    <span data-ttu-id="e7c67-118">Für 64-Bit ausführen:</span><span class="sxs-lookup"><span data-stu-id="e7c67-118">For 64 bit run:</span></span>
  ``` console
    %WINDIR%\Microsoft.NET\Framework64\v4.0.30319\ngen install <Assembly name>  
  ```

> [!TIP]
> <span data-ttu-id="e7c67-119">Generieren von systemeigenen Images für der falschen Architektur ist ein sehr häufiger Fehler.</span><span class="sxs-lookup"><span data-stu-id="e7c67-119">Generating native images for the wrong architecture is a very common mistake.</span></span> <span data-ttu-id="e7c67-120">Im Zweifelsfall können Sie systemeigene Images für alle Architekturen, die für das Betriebssystem auf dem Computer installiert gelten einfach generieren.</span><span class="sxs-lookup"><span data-stu-id="e7c67-120">When in doubt you can simply generate native images for all the architectures that apply to the operating system installed in the machine.</span></span>  

<span data-ttu-id="e7c67-121">NGen.exe unterstützt auch andere Funktionen wie z. B. deinstallieren und die installierten systemeigenen Images, die queuing der Generierung von mehreren Images usw. anzeigen. Lesen Sie weitere Informationen zur Verwendung der [NGen.exe Dokumentation](https://msdn.microsoft.com/library/6t9t5wcf.aspx).</span><span class="sxs-lookup"><span data-stu-id="e7c67-121">NGen.exe also supports other functions such as uninstalling and displaying the installed native images, queuing the generation of multiple images, etc. For more details of usage read the [NGen.exe documentation](https://msdn.microsoft.com/library/6t9t5wcf.aspx).</span></span>  

## <a name="when-to-use-ngenexe"></a><span data-ttu-id="e7c67-122">Verwendung von NGen.exe</span><span class="sxs-lookup"><span data-stu-id="e7c67-122">When to use NGen.exe</span></span>  

<span data-ttu-id="e7c67-123">Wenn es geht zu entscheiden, welche Assemblys sollen für die systemeigene Abbilder in einer Anwendung basierend auf der EF-Version 6 oder höher zu generieren, sollten Sie die folgenden Optionen berücksichtigen:</span><span class="sxs-lookup"><span data-stu-id="e7c67-123">When it comes to decide which assemblies to generate native images for in an application based on EF version 6 or greater, you should consider the following options:</span></span>  

- <span data-ttu-id="e7c67-124">**Die EF Runtime Hauptassembly EntityFramework.dll**: eine typische EF-basierten Anwendung führt eine erhebliche Menge an Code aus dieser Assembly, die beim Start oder auf den ersten Zugriff auf die Datenbank.</span><span class="sxs-lookup"><span data-stu-id="e7c67-124">**The main EF runtime assembly, EntityFramework.dll**: A typical EF based application executes a significant amount of code from this assembly on startup or on its first access to the database.</span></span> <span data-ttu-id="e7c67-125">Erstellen systemeigener Images dieser Assembly wird daher die größten Vorteile bei der Leistung beim Start generiert werden.</span><span class="sxs-lookup"><span data-stu-id="e7c67-125">Consequently, creating native images of this assembly will produce the biggest gains in startup performance.</span></span>  
- <span data-ttu-id="e7c67-126">**Jede EF-Anbieter-Assembly, die von Ihrer Anwendung verwendeten**: Dauer des Verbindungsstarts kann ebenfalls leicht generiert systemeigene Images davon profitieren.</span><span class="sxs-lookup"><span data-stu-id="e7c67-126">**Any EF provider assembly used by your application**: Startup time can also benefit slightly from generating native images of these.</span></span> <span data-ttu-id="e7c67-127">Z. B. wenn die Anwendung den EF-Anbieter für SQL Server verwendet. möchten Sie ein systemeigenes Image für EntityFramework.SqlServer.dll zu generieren.</span><span class="sxs-lookup"><span data-stu-id="e7c67-127">For example, if the application uses the EF provider for SQL Server you will want to generate a native image for EntityFramework.SqlServer.dll.</span></span>  
- <span data-ttu-id="e7c67-128">**Die Assemblys Ihrer Anwendung und andere Abhängigkeiten**: die [NGen.exe Dokumentation](https://msdn.microsoft.com/library/6t9t5wcf.aspx) behandelt allgemeine Kriterien für die Auswahl von welche Assemblys sollen für die systemeigene Abbilder und die Auswirkungen von systemeigenen Images auf Sicherheit, generieren Erweiterte Optionen wie z. B. "feste Bindung" Szenarios wie die Verwendung im Debug- und Profilerstellungstools Szenarien usw. für systemeigene Abbilder.</span><span class="sxs-lookup"><span data-stu-id="e7c67-128">**Your application’s assemblies and other dependencies**: The [NGen.exe documentation](https://msdn.microsoft.com/library/6t9t5wcf.aspx) covers general criteria for choosing which assemblies to generate native images for and the impact of native images on security, advanced options such as “hard binding”, scenarios such as using native images in debugging and profiling scenarios, etc.</span></span>  

> [!TIP]
> <span data-ttu-id="e7c67-129">Stellen Sie sicher, dass Sie sorgfältig die Auswirkungen der Verwendung von systemeigenen Images auf die Leistung beim Starten und die gesamtleistung der Anwendung zu messen, und vergleichen Sie sie mit die tatsächlichen Anforderungen.</span><span class="sxs-lookup"><span data-stu-id="e7c67-129">Make sure you carefully measure the impact of using native images on both the startup performance and the overall performance of your application and compare them against actual requirements.</span></span> <span data-ttu-id="e7c67-130">Zwar die systemeigenen Images in der Regel starten Sie die Leistung verbessern und in einigen Fällen die arbeitsspeicherbelegung reduzieren, werden nicht alle Szenarien gleichermaßen profitieren.</span><span class="sxs-lookup"><span data-stu-id="e7c67-130">While native images will generally help improve startup up performance and in some cases reduce memory usage, not all scenarios will benefit equally.</span></span> <span data-ttu-id="e7c67-131">Z. B. bei der Ausführung von stabilen Zustand kann (d. h., sobald alle Methoden, die von der Anwendung verwendeten mindestens einmal aufgerufen haben) vom JIT-Compiler generierte Code tatsächlich etwas bessere Leistung als systemeigene Abbilder erzielt werden.</span><span class="sxs-lookup"><span data-stu-id="e7c67-131">For instance, on steady state execution (that is, once all the methods being used by the application have been invoked at least once) code generated by the JIT compiler can in fact yield slightly better performance than native images.</span></span>  

## <a name="using-ngenexe-in-a-development-machine"></a><span data-ttu-id="e7c67-132">Verwendung von NGen.exe auf einem Entwicklungscomputer</span><span class="sxs-lookup"><span data-stu-id="e7c67-132">Using NGen.exe in a development machine</span></span>  

<span data-ttu-id="e7c67-133">Während der Entwicklung der .NET JIT-Compiler bietet Compiler die beste allgemeinen Kompromiss für Code, die häufig geändert wird.</span><span class="sxs-lookup"><span data-stu-id="e7c67-133">During development the .NET JIT compiler will offer the best overall tradeoff for code that is changing frequently.</span></span> <span data-ttu-id="e7c67-134">Generieren von systemeigenen Images für kompilierte Abhängigkeiten wie z. B. die EF Runtime nach Assemblys können bei Entwicklung und Tests, durch die Reduzierung von ein paar Sekunden die zu Beginn jeder Ausführung zu beschleunigen.</span><span class="sxs-lookup"><span data-stu-id="e7c67-134">Generating native images for compiled dependencies such as the EF runtime assemblies can help accelerate development and testing by cutting a few seconds out at the beginning of each execution.</span></span>  

<span data-ttu-id="e7c67-135">Ein guter Ausgangspunkt, um die EF Runtime nach Assemblys zu finden ist, den Speicherort des NuGet-Pakets für die Lösung.</span><span class="sxs-lookup"><span data-stu-id="e7c67-135">A good place to find the EF runtime assemblies is the NuGet package location for the solution.</span></span> <span data-ttu-id="e7c67-136">Z. B. für eine Anwendung mithilfe von EF 6.0.2 mit SQL Server und als Ziel .NET 4.5 oder höher, und Sie können Folgendes in ein Eingabeaufforderungsfenster (Beachten Sie, um sie als Administrator zu öffnen):</span><span class="sxs-lookup"><span data-stu-id="e7c67-136">For example, for an application using EF 6.0.2 with SQL Server and targeting .NET 4.5 or greater you can type the following in a Command Prompt window (remember to open it as an administrator):</span></span>  

``` console
cd <Solution directory>\packages\EntityFramework.6.0.2\lib\net45
%WINDIR%\Microsoft.NET\Framework\v4.0.30319\ngen install EntityFramework.SqlServer.dll
%WINDIR%\Microsoft.NET\Framework64\v4.0.30319\ngen install EntityFramework.SqlServer.dll
```  

> [!NOTE]
> <span data-ttu-id="e7c67-137">Diese nutzt die Tatsache, die Installation von systemeigenen Images für EF-Anbieter für SQL Server wird standardmäßig auch die systemeigenen Images für die Hauptassembly der EF-Laufzeit installiert wird.</span><span class="sxs-lookup"><span data-stu-id="e7c67-137">This takes advantage of the fact that installing the native images for EF provider for SQL Server will also by default install the native images for the main EF runtime assembly.</span></span> <span data-ttu-id="e7c67-138">Dies funktioniert, da NGen.exe erkennen kann, dass EntityFramework.dll direkte Abhängigkeit von der EntityFramework.SqlServer.dll-Assembly befindet sich im gleichen Verzeichnis ist.</span><span class="sxs-lookup"><span data-stu-id="e7c67-138">This works because NGen.exe can detect that EntityFramework.dll is a direct dependency of the EntityFramework.SqlServer.dll assembly located in the same directory.</span></span>  

## <a name="creating-native-images-during-setup"></a><span data-ttu-id="e7c67-139">Erstellen systemeigener Images während des Setups</span><span class="sxs-lookup"><span data-stu-id="e7c67-139">Creating native images during setup</span></span>  

<span data-ttu-id="e7c67-140">Dem WiX-Toolkit unterstützt die Generierung von systemeigenen Images für verwaltete Assemblys während des Setups queuing, wie dies unter [Leitfaden](http://wixtoolset.org/documentation/manual/v3/howtos/files_and_registry/ngen_managed_assemblies.html).</span><span class="sxs-lookup"><span data-stu-id="e7c67-140">The WiX Toolkit supports queuing the generation of native images for managed assemblies during setup, as explained in this [how-to guide](http://wixtoolset.org/documentation/manual/v3/howtos/files_and_registry/ngen_managed_assemblies.html).</span></span> <span data-ttu-id="e7c67-141">Eine weitere Alternative ist beim Erstellen einer benutzerdefinierten Installation-Aufgabe, die den NGen.exe-Befehl ausführen.</span><span class="sxs-lookup"><span data-stu-id="e7c67-141">Another alternative is to create a custom setup task that execute the NGen.exe command.</span></span>  

## <a name="verifying-that-native-images-are-being-used-for-ef"></a><span data-ttu-id="e7c67-142">Überprüfen, dass systemeigene Images für Entity Framework verwendet werden</span><span class="sxs-lookup"><span data-stu-id="e7c67-142">Verifying that native images are being used for EF</span></span>  

<span data-ttu-id="e7c67-143">Sie können überprüfen, ob eine bestimmte Anwendung eine native Assembly verwendet anhand der geladenen Assemblys mit der Erweiterung ". ni.dll"oder". ni.exe".</span><span class="sxs-lookup"><span data-stu-id="e7c67-143">You can verify that a specific application is using a native assembly by looking for loaded assemblies that have the extension “.ni.dll” or “.ni.exe”.</span></span> <span data-ttu-id="e7c67-144">Beispielsweise wird ein systemeigenes Image für die EF-main Runtime-Assembly EntityFramework.ni.dll aufgerufen.</span><span class="sxs-lookup"><span data-stu-id="e7c67-144">For example, a native image for the EF’s main runtime assembly will be called EntityFramework.ni.dll.</span></span> <span data-ttu-id="e7c67-145">Eine einfache Möglichkeit, überprüfen Sie die geladenen Assemblys von .NET eines Prozesses ist die Verwendung [Process Explorer](https://technet.microsoft.com/sysinternals/bb896653).</span><span class="sxs-lookup"><span data-stu-id="e7c67-145">An easy way to inspect the loaded .NET assemblies of a process is to use [Process Explorer](https://technet.microsoft.com/sysinternals/bb896653).</span></span>  

## <a name="other-things-to-be-aware-of"></a><span data-ttu-id="e7c67-146">Andere Dinge zu beachten</span><span class="sxs-lookup"><span data-stu-id="e7c67-146">Other things to be aware of</span></span>  

<span data-ttu-id="e7c67-147">**Erstellen ein systemeigenes Image einer Assembly darf nicht mit Registrieren der Assembly in verwechselt werden die [GAC (Global Assembly Cache)](https://msdn.microsoft.com/library/yf1d93sz.aspx)**.</span><span class="sxs-lookup"><span data-stu-id="e7c67-147">**Creating a native image of an assembly should not be confused with registering the assembly in the [GAC (Global Assembly Cache)](https://msdn.microsoft.com/library/yf1d93sz.aspx)**.</span></span> <span data-ttu-id="e7c67-148">NGen.exe ermöglicht das Erstellen von Images der Assemblys, die nicht im globalen Assemblycache enthalten sind, und in der Tat können mehrere Anwendungen, die eine bestimmte Version von EF verwenden das gleiche native Image freigeben.</span><span class="sxs-lookup"><span data-stu-id="e7c67-148">NGen.exe allows creating images of assemblies that are not in the GAC, and in fact, multiple applications that use a specific version of EF can share the same native image.</span></span> <span data-ttu-id="e7c67-149">Während Windows 8 automatisch native Images für Assemblys im GAC abgelegt erstellen können, die EF Runtime wurde optimiert, um zusammen mit Ihrer Anwendung bereitgestellt werden, und es wird nicht empfohlen, im GAC zu registrieren, da dies negative Auswirkungen auf die Assembly-Auflösung hat und Wartung Ihrer Anwendungen auf andere Aspekte.</span><span class="sxs-lookup"><span data-stu-id="e7c67-149">While Windows 8 can automatically create native images for assemblies placed in the GAC, the EF runtime is optimized to be deployed alongside your application and we do not recommend registering it in the GAC as this has a negative impact on assembly resolution and servicing your applications among other aspects.</span></span>  
